# SPEC-REFACTOR-001: 인수 기준 (Acceptance Criteria)

## 태그 블록 (TAG BLOCK)

TAG: SPEC-REFACTOR-001
TYPE: ACCEPTANCE
VERSION: 1.0
DATE: 2026-02-03
RELATED-SPEC: spec.md, plan.md

---

## 1. 정의 완료 (Definition of Done)

### 1.1 최종 정의 완료 체크리스트

각 모듈은 다음 조건을 모두 만족해야 합니다:

- [ ] 코드 리뷰 완료 및 승인
- [ ] 단위 테스트 작성 및 통과
- [ ] 커버리지 70% 이상 달성
- [ ] CDC 검증 통과 (0개 위반)
- [ ] 리셋 일관성 확인
- [ ] 타이밍 제약 추가
- [ ] 문서화 완료
- [ ] 회귀 테스트 통과

---

## 2. 테스트 시나리오 (Test Scenarios)

### 2.1 Given-When-Then 형식 테스트 시나리오

#### TS-001: 리셋 정책 일관성 (UR-001)

Scenario: 모든 리셋 신호가 active-LOW 극성을 가짐

Given 시스템이 초기화되고
When 모든 모듈의 리셋 신호를 검사하면
Then 모든 리셋 신호 이름은 *_n*으로 끝나야 하고
And 리셋 시 논리 0이 활성화되어야 하며
And 리셋 해제 시 논리 1이 비활성화되어야 한다

---

#### TS-002: CDC 안전성 (UR-002, ED-001)

Scenario: 클럭 도메인 경계에서 모든 신호가 안전하게 동기화됨

Given 서로 다른 클럭 도메인 간의 신호 경계가 있고
When 신호가 클럭 도메인을 경계하면
Then 2단계 이상의 플립플롭 동기화를 사용하거나
And async_fifo를 사용해야 하며
And Vivado CDC Report에서 0개의 위반이 보고되어야 한다

---

#### TS-003: FSM 3블록 스타일 (UR-003, ED-003)

Scenario: 모든 상태 기계가 3블록 스타일로 작성됨

Given FSM이 존재하고
When FSM 코드를 분석하면
Then 상태 레지스터 블록이 존재해야 하고
And 다음 상태 로직 블록이 존재해야 하며
And 출력 로직 블록이 존재해야 하고
And 세 블록이 분리되어 있어야 한다

---

#### TS-004: 모듈 단일 책임 (UR-004)

Scenario: 각 모듈이 단일 명확한 기능만 수행함

Given 모듈이 존재하고
When 모듈 코드를 검토하면
Then 모듈은 하나의 명확한 기능만 수행해야 하고
And 모듈 이름이 기능을 명확히 설명해야 하며
And 모듈 라인 수가 500 이하여야 한다

---

#### TS-005: cyan_top.sv 라인 수 (TOP-001)

Scenario: cyan_top.sv가 300 라인 미만으로 감소함

Given 리팩토링이 완료되고
When cyan_top.sv 라인 수를 측정하면
Then 라인 수가 300 미만이어야 하고
And 모든 기능이 정상 작동해야 하며
And 합성 에러가 없어야 한다

---

#### TS-006: 리셋 중 신호 상태 (SD-001)

Scenario: 리셋 중 모든 출력이 안전한 값을 가짐

Given 시스템이 리셋 상태이고
When 모든 출력 신호를 검사하면
Then 모든 출력이 알려진 안전한 값을 가져야 하고
And Hi-Z 상태는 명확한 문서화가 있어야 하며
And 출력이 undefined 상태가 아니어야 한다

---

#### TS-007: 클럭 락 탐지 (SD-002)

Scenario: PLL/MMCM이 락되지 않으면 리셋 유지

Given 시스템이 전원을 켜고
When PLL/MMCM이 락되지 않았으면
Then 시스템은 리셋을 유지해야 하고
And 모든 동작이 중단되어야 하며
And PLL/MMCM 락 신호가 확인되면 리셋 해제되어야 한다

---

#### TS-008: 백바이어스 모드 (SD-004)

Scenario: 백바이어스 인덱스 활성 시 게이트 신호 제어

Given 시스템이 백바이어스 인덱스 상태이고
When 백바이어스 파라미터가 설정되면
Then 게이트 신호가 백바이어스 레벨에 맞게 제어되어야 하고
And XAO 신호가 정확한 타이밍에 활성화되어야 하며
And 정상적인 이미지 판독이 중단되어야 한다

---

#### TS-009: 직접 클럭 도메인 경계 금지 (UB-001)

Scenario: 어떠한 신호도 동기화 없이 클럭 도메인을 경계하지 않음

Given 모든 신호 경로를 검사하고
When 클럭 도메인 경계를 찾으면
Then 모든 경계에 동기화가 있어야 하고
And lint_cdc_check가 0개의 경고를 보고해야 하며
And Vivado CDC Report가 0개의 위반을 보고해야 한다

---

#### TS-010: 혼합 리셋 극성 금지 (UB-002)

Scenario: 동일한 클럭 도메인 내에서 리셋 극성이 일치함

Given 클럭 도메인을 선택하고
When 해당 도메인 내의 모든 리셋 신호를 검사하면
Then 모든 리셋이 동일한 극성을 가져야 하고
And active-HIGH와 active-LOW가 혼합되지 않아야 하며
And 리셋 매트릭스가 일관성을 보여야 한다

---

#### TS-011: 2블록 FSM 금지 (UB-003)

Scenario: 어떠한 FSM도 2블록 스타일로 작성되지 않음

Given 모든 FSM을 검사하고
When FSM 구조를 분석하면
Then 출력 로직이 상태 레지스터와 결합되지 않아야 하고
And 항상 3개의 분리된 블록이 존재해야 하며
And 코드 리뷰가 3블록 준수를 확인해야 한다

---

#### TS-012: 테스트 커버리지 (UR-005)

Scenario: 모든 새로운 모듈이 70% 이상의 테스트 커버리지를 가짐

Given 새로운 모듈이 작성되고
When 테스트 커버리지를 측정하면
Then 커버리지가 70% 이상이어야 하고
And 모든 주요 경로가 커버되어야 하며
And 커버리지 리포트가 생성되어야 한다

---

## 3. 검증 방법 (Verification Methods)

### 3.1 정적 분석 (Static Analysis)

| 도구 | 목적 | 기준 |
|------|------|------|
| Verilator | Lint 검사 | 0개 경고 |
| Vivado Synthesis | 합성 가능성 | 0개 에러 |
| CDC Report | CDC 검증 | 0개 위반 |
| Timing Report | 타이밍 | WNS > 0 |

### 3.2 동적 검증 (Dynamic Verification)

| 방법 | 범위 | 기준 |
|------|------|------|
| 단위 테스트 | 모듈별 | 100% 통과 |
| 통합 테스트 | 모듈 간 | 100% 통과 |
| 회귀 테스트 | 시스템 | 0개 회귀 |
| 커버리지 | 코드 라인 | >70% |

---

## 4. 품질 게이트 기준 (Quality Gate Criteria)

### 4.1 단계별 품질 게이트

#### Week 6 품질 게이트

| 항목 | 검증 방법 | 통과 기준 |
|------|-----------|-----------|
| 모듈 추출 완료 | 코드 검사 | debug_integration.sv, sync_processing.sv 존재 |
| CDC 검증 | Vivado CDC Report | 0개 위반 |
| 리셋 일관성 | 리셋 매트릭스 | 100% active-LOW |
| 테스트 통과 | 시뮬레이션 | 100% 통과 |
| 라인 수 | wc -l | cyan_top.sv <900 라인 |

#### Week 7 품질 게이트

| 항목 | 검증 방법 | 통과 기준 |
|------|-----------|-----------|
| 모듈 추출 완료 | 코드 검사 | 4개 모듈 추출 완료 |
| CDC 검증 | Vivado CDC Report | 0개 위반 |
| 게이트 드라이버 | 시뮬레이션 | GF_* 신호 정상 작동 |
| 라인 수 | wc -l | cyan_top.sv <550 라인 |

#### Week 8 품질 게이트

| 항목 | 검증 방법 | 통과 기준 |
|------|-----------|-----------|
| 모듈 추출 완료 | 코드 검사 | 6개 모듈 추출 완료 |
| 리셋 트리 | 리셋 매트릭스 | 완전한 트리 문서화 |
| 테스트 통과 | 시뮬레이션 | 100% 통과 |
| 라인 수 | wc -l | cyan_top.sv <300 라인 |

#### Week 9-10 품질 게이트 (최종)

| 항목 | 검증 방법 | 통과 기준 |
|------|-----------|-----------|
| FSM 3블록 | 코드 리뷰 | 100% 준수 |
| CDC 위반 | Vivado CDC Report | 0개 |
| 리셋 일관성 | 리셋 매트릭스 | 100% active-LOW |
| 타이밍 | Vivado 타이밍 | WNS > 0 |
| 커버리지 | 커버리지 리포트 | >70% |
| 회귀 | 회귀 테스트 | 0개 실패 |
| 라인 수 | wc -l | cyan_top.sv <300 라인 |

---

## 5. 최종 인수 기준 (Final Acceptance Criteria)

### MUST (반드시 만족)

| 기준 | 측정 방법 | 목표 |
|------|-----------|------|
| cyan_top.sv 라인 수 | wc -l | <300 |
| CDC 위반 | Vivado CDC Report | 0 |
| 리셋 일관성 | 리셋 매트릭스 | 100% active-LOW |
| FSM 3블록 | 코드 리뷰 | 100% |
| 기능 회귀 | 회귀 테스트 | 0개 |
| 타이밍 | WNS | >0 |

### SHOULD (가능하면 만족)

| 기준 | 측정 방법 | 목표 |
|------|-----------|------|
| 테스트 커버리지 | 커버리지 리포트 | >70% |
| 코드 규칙 준수 | Lint 검사 | 0개 경고 |
| 문서화 완료 | 문서 검사 | 100% |

---

## 6. 성공 지표 (Success Metrics)

### 정량적 지표

| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|-----------|
| cyan_top.sv 라인 | 1,261 | <300 | wc -l |
| CDC 위반 | 0 | 0 | Vivado CDC Report |
| 리셋 일관성 | 100% | 100% | 리셋 매트릭스 |
| FSM 3블록 | 50% | 100% | 코드 리뷰 |
| 테스트 커버리지 | 23% | >70% | 커버리지 리포트 |
| WNS | TBD | >0 | 타이밍 리포트 |

---

## 7. 추적성 (Traceability)

### 테스트-요구사항 매핑

| 테스트 ID | 관련 요구사항 | 검증 방법 |
|-----------|---------------|-----------|
| TS-001 | UR-001 | 리셋 매트릭스 검사 |
| TS-002 | UR-002, ED-001 | CDC 리포트 검사 |
| TS-003 | UR-003, ED-003 | FSM 스타일 검사 |
| TS-004 | UR-004 | 모듈 단일 책임 검사 |
| TS-005 | TOP-001 | wc -l |
| TS-006 | SD-001 | 리셋 상태 시뮬레이션 |
| TS-007 | SD-002 | 클럭 락 시뮬레이션 |
| TS-008 | SD-004 | 백바이어스 모드 테스트 |
| TS-009 | UB-001 | Lint CDC 검사 |
| TS-010 | UB-002 | 리셋 극성 검사 |
| TS-011 | UB-003 | FSM 블록 구조 검사 |
| TS-012 | UR-005 | 커버리지 리포트 |

---

문서 버전: 1.0
작성일: 2026-02-03
다음 업데이트: Week 6 완료 시
